{% extends "website/base.html" %}
{% load static %}
{% load filter %}
{% block title %}
    <title>{{ room.product_id.name }}</title>
{% endblock %}

{% block stylesheet %}
  <!--Important link from https://bootsnipp.com/snippets/XqvZr-->
<!--  <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">-->
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!------ Include the above in your HEAD tag ---------->

  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"><div class="pd-wrap">
  <style>
      .pd-wrap {
  padding: 40px 0;
  font-family: 'Arial', sans-serif;
}
.heading-section {
  text-align: center;
  margin-bottom: 20px;
}
.sub-heading {
  font-family: 'Arial', sans-serif;
    font-size: 12px;
    display: block;
    font-weight: 600;
    color: #2e9ca1;
    text-transform: uppercase;
    letter-spacing: 2px;
}
.heading-section h2 {
  font-size: 32px;
    font-weight: 500;
    padding-top: 10px;
    padding-bottom: 15px;
  font-family: 'Arial', sans-serif;
}
.user-img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    position: relative;
  min-width: 80px;
  background-size: 100%;
}
.carousel-testimonial .item {
  padding: 30px 10px;
}
.quote {
  position: absolute;
    top: -23px;
    color: #2e9da1;
    font-size: 27px;
}
.name {
  margin-bottom: 0;
    line-height: 14px;
    font-size: 17px;
    font-weight: 500;
}
.position {
  color: #adadad;
  font-size: 14px;
}
.owl-nav button {
  position: absolute;
  top: 50%;
  transform: translate(0, -50%);
  outline: none;
  height: 25px;
}
.owl-nav button svg {
  width: 25px;
  height: 25px;
}
.owl-nav button.owl-prev {
  left: 25px;
}
.owl-nav button.owl-next {
  right: 25px;
}
.owl-nav button span {
  font-size: 45px;
}
.product-thumb .item img {
  height: 100px;
}
.product-name {
  font-size: 22px;
  font-weight: 500;
  line-height: 22px;
  margin-bottom: 4px;
}
.product-price-discount {
  font-size: 22px;
    font-weight: 400;
    padding: 10px 0;
    clear: both;
}
.product-price-discount span.line-through {
  text-decoration: line-through;
    margin-left: 10px;
    font-size: 14px;
    vertical-align: middle;
    color: #a5a5a5;
}
.display-flex {
  display: flex;
}
.align-center {
  align-items: center;
}
.product-info {
  width: 100%;
}
.reviews-counter {
    font-size: 13px;
}
.reviews-counter span {
  vertical-align: -2px;
}
.rate {
    float: left;
    padding: 0 10px 0 0;
}
.rate:not(:checked) > input {
    position:absolute;
    top:-9999px;
}
.rate:not(:checked) > label {
    float: right;
    width: 15px;
    overflow: hidden;
    white-space: nowrap;
    cursor: pointer;
    font-size: 21px;
    color:#ccc;
  margin-bottom: 0;
  line-height: 21px;
}
.rate:not(:checked) > label:before {
    content: '\2605';
}
.rate > input:checked ~ label {
    color: #ffc700;
}
.rate:not(:checked) > label:hover,
.rate:not(:checked) > label:hover ~ label {
    color: #deb217;
}
.rate > input:checked + label:hover,
.rate > input:checked + label:hover ~ label,
.rate > input:checked ~ label:hover,
.rate > input:checked ~ label:hover ~ label,
.rate > label:hover ~ input:checked ~ label {
    color: #c59b08;
}
.product-dtl p {
  font-size: 14px;
  line-height: 24px;
  color: #7a7a7a;
}
.product-dtl .form-control {
  font-size: 15px;
}
.product-dtl label {
  line-height: 16px;
  font-size: 15px;
}
.form-control:focus {
  outline: none;
  box-shadow: none;
}
.product-count {
  margin-top: 15px;
}
.product-count .qtyminus,
.product-count .qtyplus {
  width: 34px;
    height: 34px;
    background: #212529;
    text-align: center;
    font-size: 19px;
    line-height: 36px;
    color: #fff;
    cursor: pointer;
}
.product-count .qtyminus {
  border-radius: 3px 0 0 3px;
}
.product-count .qtyplus {
  border-radius: 0 3px 3px 0;
}
.product-count .qty {
  width: 60px;
  text-align: center;
}
.round-black-btn {
  border-radius: 4px;
    background: #212529;
    color: #fff;
    padding: 7px 45px;
    display: inline-block;
    margin-top: 20px;
    border: solid 2px #212529;
    transition: all 0.5s ease-in-out 0s;
}
.round-black-btn:hover,
.round-black-btn:focus {
  background: transparent;
  color: #212529;
  text-decoration: none;
}

.product-info-tabs {
  margin-top: 25px;
}
.product-info-tabs .nav-tabs {
  border-bottom: 2px solid #d8d8d8;
}
.product-info-tabs .nav-tabs .nav-item {
  margin-bottom: 0;
}
.product-info-tabs .nav-tabs .nav-link {
  border: none;
  border-bottom: 2px solid transparent;
  color: #323232;
}
.product-info-tabs .nav-tabs .nav-item .nav-link:hover {
  border: none;
}
.product-info-tabs .nav-tabs .nav-item.show .nav-link,
.product-info-tabs .nav-tabs .nav-link.active,
.product-info-tabs .nav-tabs .nav-link.active:hover {
  border: none;
  border-bottom: 2px solid #d8d8d8;
  font-weight: bold;
}
.product-info-tabs .tab-content .tab-pane {
  padding: 30px 20px;
  font-size: 15px;
  line-height: 24px;
  color: #7a7a7a;
}
.review-form .form-group {
  clear: both;
}
.mb-20 {
  margin-bottom: 20px;
}

.review-form .rate {
  float: none;
  display: inline-block;
}
.review-heading {
  font-size: 24px;
    font-weight: 600;
    line-height: 24px;
    margin-bottom: 6px;
    text-transform: uppercase;
    color: #000;
}
.review-form .form-control {
  font-size: 14px;
}
.review-form input.form-control {
  height: 40px;
}
.review-form textarea.form-control {
  resize: none;
}
.review-form .round-black-btn {
  text-transform: uppercase;
  cursor: pointer;
}

  </style>
{% endblock %}
    {% block style-all-wrapper%} style = 'margin-left: 40px;'{% endblock %}
    {% block header-seller%} class="header-top-area header-seller" {% endblock %}
                                    {% block list-menu %}
                                    <div class="col-lg-1 col-md-0 col-sm-1 col-xs-12">
<!--                                        <div class="menu-switcher-pro">-->
<!--                                            <button type="button" id="sidebarCollapse" class="btn bar-button-pro header-drl-controller-btn btn-info navbar-btn">-->
<!--													<i class="educate-icon educate-nav"></i>-->
<!--											</button>-->
<!--                                        </div>-->
                                    </div>
                                    <div class="col-lg-6 col-md-7 col-sm-6 col-xs-12">
                                        <div class="header-top-menu tabl-d-n">
                                            <ul class="nav navbar-nav mai-top-nav">
                                                <li class="nav-item"><a href="/home" class="nav-link">Trang chủ</a>
                                                </li>
                                                <li class="nav-item"><a href="/usr/0/history_bidding_list" class="nav-link">Lịch sử đặt giá</a>
                                                </li>
                                                <li class="nav-item"><a href="/seller/product" class="nav-link">Đơn hàng</a>
                                                </li>
                                                <li class="nav-item"><a href="/usr/0/message" class="nav-link">Tin nhắn</a>
                                                </li>
                                                <li class="nav-item"><a href="/usr/0/cancel/bid" class="nav-link">Trợ giúp</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    {% endblock %}
{% block Start-Left-menu-area %}
{% endblock %}

{% block search %}
    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="breadcome-heading">
            <form role="search" class="sr-input-func">
<!--                <input type="text" placeholder="Search..." class="search-int form-control">-->
<!--                <a href="#"><i class="fa fa-search"></i></a>-->
            </form>
        </div>
    </div>
{% endblock %}
    {% block link %}
    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <ul class="breadcome-menu">
            <li><a href="#">Trang chủ</a> <span class="bread-slash">/</span>
            </li>
            <li><span class="bread-blod">Chi tiết phòng</span>
            </li>
        </ul>
    </div>
    {% endblock %}

{% block content %}
    <div class="container seller" id="reload" style="margin: 10px; width:100%;">
        <div class="col-md-2" style="margin: 10px;">
            <div class="col-sd-6" style="background-color: white; margin-bottom: 10px; border: 1px solid #e2e2e2; overflow: hidden; border-radius: 3px;">
                <p style="color: #31789b; background-color: #d9edf7; text-align: center; border-bottom: 1px solid #e2e2e2; font-size: 16px; padding: 15px;"><b>Thông tin người bán</b></p>
                <p style="font-size: 16px; padding: 8px;">Tài khoản: {{room.seller_id.pk}}</p>
                <p style="font-size: 16px; padding: 8px;">Email: {{room.seller_id.email|truncatechars:10}}</p>
                <p style="font-size: 16px; padding: 8px; text-align: center;"><a style="color: blue;" href="/chat/id/usr/{{room.seller_id.pk}}">Chat với người bán</a></p>
            </div>
        </div>
        <div class="col-md-9" style="background-color: white; margin: 10px; padding: 10px;">
            {% if room.seller_id.id == check_seller %}
          <div class="alert alert-info" role="alert">
              <strong>Thông báo!</strong> Bạn không thể tham gia đấu giá sản phẩm mà bạn đăng bán.
          </div>
        {% endif %}
          <div class="heading-section">
              <h2>{{ room.product_id.name }}</h2>
          </div>
          <div class="row">
            <div class="col-md-6">
               <div id="slider" class="owl-carousel product-slider">
                {% for i in room.product_id.image %}
                 <div class="item">
                   <img src="{{ i.url }}" />
                 </div>
                 {% endfor %}
               </div>
               <div id="thumb" class="owl-carousel product-thumb">
                 {% for i in room.product_id.image %}
                 <div class="item">
                   <img src="{{ i.url }}" />
                 </div>
                 {% endfor %}
               </div>
            </div>
            <div class="col-md-6">
              <div class="product-dtl">
                <div class="product-info">
                  <div class="product-name">Tình trạng:
                      {% if room.product_id.condition == 'new' %}
                        Hàng mới
                      {% elif room.product_id.condition == 'used' %}
                        Đã sử dụng
                      {% elif room.product_id.condition == 'open box' %}
                        Đã mở hộp
                      {% endif %}
                  </div>
                   <p class="product-price-discount"><span>Số lượng: {{ room.product_id.quantity }}</span></p>
                </div>
                  <p></p>
<!--                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>-->
                <div class="row" style="margin-bottom: 20px;">
                  <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                      <b>Thời gian:</b>
                  </div>
                  <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
                      <p class="timer"><span><i class="fa fa-clock"></i></span> </p>
                      <input type="hidden" class="set-time" value="{{ room.end|date:'Y-m-d H:i' }}"/>
                      <div class="countdown">
                          <div class='tiles color-full'></div>
                      </div>
                  </div>
                </div>
                <div class="row" style="margin-bottom: 20px;">
                  <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                      <b>Giá hiện tại:</b>
                  </div>
                  <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12" id="or-current_bid1">
                      <b style="font-size: 20px;">{{ room.current_bid|add:"0" }}<u>đ</u></b>
                  </div>
                </div>
                <input type="hidden" id="or-hb" value="{{room.highestbidder_bid}}">
                {% if room.seller_id.id != check_seller %}
                <div class="row" style="margin-bottom: 20px;">
                  {% if room.status == 'opening' %}
                  <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                      <b>Nhập giá:</b>
                  </div>
                  <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
                      <div class="input-group">
                         <input type="text" id="bids0" data-mask="999999" title="Đơn giá 1000VND" placeholder="Nhập giá tiền" class="form-control" required="" autocomplete="off" maxlength="6">
                         <span class="input-group-addon">VND</span>
                      </div>
                      <div class="next-bids"></div>
                  </div>
                  {% elif room.status == 'closed' %}
                  <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                      <b>Tình trạng:</b>
                  </div>
                  <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
                      <p><b style="color: red;">ĐÃ ĐÓNG</b></p>
                  </div>
                  {% endif %}
                </div>
                <div class="product-count" style="text-align: center;">
                 {% if room.status == 'opening' %}
                  <input id="btn-room" type="hidden" value="{{room.pk}}">
                  <button type="submit" id="show-modal" class="btn btn-primary waves-effect waves-light">Đặt giá</button>
<!--                  <button type="submit" class="btn btn-primary waves-effect waves-light">Đặt nhanh</button>-->
                  {% elif room.status == 'closed' %}
                    <button type="submit" id="show-history" class="btn btn-primary waves-effect waves-light">Xem lịch sử</button>
                  {% endif %}
                </div>
                {% endif %}
                  <input type="hidden" value="{{room.pk}}" id="room_id">
                  <input type="hidden" value="{{room.status}}" id="room_status">
              </div>
            </div>
          </div>
          <div class="product-info-tabs">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
               <li class="nav-item">
                  <a class="nav-link active" id="description-tab" data-toggle="tab" href="#description" role="tab" aria-controls="description" aria-selected="true">Mô tả</a>
               </li>
               <li class="nav-item">
                 <a class="nav-link" id="review-tab" data-toggle="tab" href="#review" role="tab" aria-controls="review" aria-selected="false">Thuộc tính đặc trưng</a>
               </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
                   {{ room.product_id.decription }}
                </div>
                <div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
                  <div style="border: solid 1px; border-color: #0000006b; padding: 10px;">
                   <p><b>Thuộc tính đặc trưng</b></p>
                   {% for p in pr_att %}
                     <p>{{ p.attributes.name }}: {{ p.content }}</p>
                   {% endfor %}
                  </div>
                </div>
            </div>
          </div>
        </div>

    </div>

<!--          <div style="text-align:center;font-size:14px;padding-bottom:20px;">Get free icon packs for your next project at <a href="http://iiicons.in/" target="_blank" style="color:#ff5e63;font-weight:bold;">www.iiicons.in</a></div>-->
    </div>
  <!-- Modal -->
        <div class="modal" id="myModal" style="background-color: #808080b5;" role="dialog">
          <div class="modal-dialog">
            <form method="post" id="form-bid">
            {% csrf_token %}
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Xem lại và xác nhận giá đặt cược</h4>
              </div>
              <div class="modal-body">
                <div class="alert alert-warning" role="alert">
                    <strong>Lưu ý!</strong> Số tiền tối đa là số tiền bạn sẵn sàng chi trả cho món hàng khi đặt cược.
                </div>
                <div class="row" style="margin-bottom: 20px;">
                  <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                      <b>Thời gian:</b>
                  </div>
                  <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
                      <p class="timer"><span><i class="fa fa-clock"></i></span> </p>
                      <input type="hidden" class="set-time" value="{{ room.end|date:'Y-m-d H:i' }}"/>
                      <div class="countdown">
                          <div class='tiles color-full'></div>
                      </div>
                  </div>
                </div>
                <div class="row" style="margin-bottom: 20px;">
                  <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                      <b>Giá hiện tại:</b>
                  </div>
                  <div id="or-current_bid2" class="col-lg-9 col-md-9 col-sm-9 col-xs-12" style="font-size: 20px;">
                      <b>{{ room.current_bid|add:"0" }}<u>đ</u></b>
                  </div>
                </div>
                {% if hs_bidding.bids is not None %}
                  <div class="row" style="margin-bottom: 20px;">
                  <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                      <b>Số tiền tối đa đã đặt:</b>
                  </div>
                  <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12" id="or-max_bid">
                      <b style="font-size: 20px;">{{ hs_bidding.bids|add:"0" }}<u>đ</u></b>
                  </div>
                  <p class="hb" id="hb"></p>
                  <p id="or-behb"></p>
                </div>
                {% endif %}
                <div class="row" style="margin-bottom: 20px;">
                  <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                      <b>Số tiền tối đa:</b>
                  </div>
                  <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
                      <div class="input-group">
                         <input id="bids1" type="text" name="bids" data-mask="999999" title="Đơn giá 1000VND" placeholder="Nhập giá tiền" class="form-control" required="" autocomplete="off" maxlength="6">
                         <span class="input-group-addon">VND</span>
                      </div>
                      <div class="next-bids"></div>
                      <p id="or-gtt"></p>
                      <p id="giatt"></p>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <input type="hidden" name="id" id="id_room" value="{{ room.pk }}">
                <input type="hidden" id="time_out" value="0">
                <button type="submit" class="btn btn-default" data-dismiss="modal">Đồng ý</button>
              </div>
            </div>
            </form>
          </div>
        </div>
<!-- End Modal -->
  <!-- Modal History-->
        <div class="modal" id="HistoryModal" style="background-color: #808080b5;" role="dialog">
          <div class="modal-dialog">
<!--            <form method="post" id="form-bid">-->
<!--            {% csrf_token %}-->
            <!-- Modal content-->
            <div class="modal-content">
             <form id="form" method="post">
               {% csrf_token %}
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Thông báo</h4>
              </div>
              <div class="modal-body">
                <div class="row" id="show_his" style="margin-bottom: 20px;">
                  <div class="card">
                    <div class="card-body text-center"> <img src="https://img.icons8.com/bubbles/200/000000/trophy.png">
                       <h4>Chúc mừng!</h4>
                       <p>Bạn là người chiến thắng. Vui lòng thanh toán sản phẩm trong thời gian quy định.</p>
                       <button formaction="/momo/{{room.pk}}" class="btn btn-out btn-square continue" type="submit">THANH TOÁN</button>
                    </div>

                  </div>
                </div>
              </div>
              </form>
              <div class="modal-footer">
                <input type="hidden" name="usr" id="usr" value="{{ username }}">
<!--                <button type="submit" class="btn btn-default" data-dismiss="modal">Đồng ý</button>-->
              </div>
            </div>
<!--            </form>-->
          </div>
        </div>
<!-- End Modal -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity=" sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script><script>
<!--   console.log('done did the form Funct: ');-->
    var slides= document.getElementsByClassName('set-time');
    Array.prototype.forEach.call(slides, function(slide, index) {
    var t = slides.item(index).value;
      var tgianht = new Date().getTime();
      var end = Date.parse(t);
      var minutes = (end/60000) - (tgianht/ 60000);

<!--       var minutes = $( '#set-time' ).val();-->

var target_date = new Date().getTime() + ((minutes * 60 ) * 1000); // set the countdown date
var time_limit = ((minutes * 60 ) * 1000);

if ($("#room_status").val() == 'opening'){
   //set actual timer
setTimeout(
  function()
  {
  $('#time_out').val(1);
<!--    alert( $('#time_out').val() );-->
  }, time_limit );
}


var days, hours, minutes, seconds; // variables for time units

<!--var v = slides.item(index).parentNode;-->
var y = slides.item(index).closest('.course-des');
<!--var timer = y.getElementsByClassName("timer");-->
var timer = document.getElementsByClassName("timer")[index];

<!--var countdown = y.getElementsByClassName("tiles"); // get tag element-->
var countdown = document.getElementsByClassName("tiles")[index]; // get tag element

getCountdown();

setInterval(function () { getCountdown();
  $.get('/reload_bid/'+$('#room_id').val(), function(data) {
    $.each(['current_bid1', 'current_bid2', 'max_bid', 'gtt', 'behb'], function(i, key) {
        $('#or-' + key).html($(data).find('#re-' + key));
    });
}, 'html');

 }, 1000);

function getCountdown(){

	// find the amount of "seconds" between now and target
	var current_date = new Date().getTime();
	var seconds_left = (target_date - current_date) / 1000;

if ( seconds_left >= 0 ) {
  console.log(time_limit);
<!--   if ( (seconds_left * 1000 ) < ( time_limit / 2 ) )  {-->
<!--     $( '.tiles' )[index].removeClass('color-full');-->
<!--     $( '.tiles' )[index].addClass('color-half');-->

<!--		}-->
<!--    if ( (seconds_left * 1000 ) < ( time_limit / 4 ) )  {-->
<!--    	$( '.tiles' )[index].removeClass('color-half');-->
<!--    	$( '.tiles' )[index].addClass('color-empty');-->
<!--    }-->
	days = pad( parseInt(seconds_left / 86400) );
	seconds_left = seconds_left % 86400;

	hours = pad( parseInt(seconds_left / 3600) );
	seconds_left = seconds_left % 3600;

	minutes = pad( parseInt(seconds_left / 60) );
	seconds = pad( parseInt( seconds_left % 60 ) );

	// format countdown string + set tag value
	if  (days != 00) {
	   var c = "<span class='t'> " + days +" ngày, "+ hours + ":</span><span class='t'>" + minutes + ":</span><span class='t'>" + seconds + "</span>";
	}
	else if (days != 00 && minutes != 00 && hours != 00){
	   var c = "<span class='t'> " + days +" ngày, "+ hours + ":</span><span class='t'>" + minutes + ":</span><span class='t'>" + seconds + "</span>";
	}
	else
	{
	   var c = "<span class='t'> " + hours + ":</span><span class='t'>" + minutes + ":</span><span class='t'>" + seconds + "</span>";
	}
    timer.innerHTML = c;


}



}

function pad(n) {
	return (n < 10 ? '0' : '') + n;
}
});

</script>
<script>
    $(document).ready(function() {
        var slider = $("#slider");
        var thumb = $("#thumb");
        var slidesPerPage = 4; //globaly define number of elements per page
        var syncedSecondary = true;
        slider.owlCarousel({
            items: 1,
            slideSpeed: 2000,
            nav: false,
            autoplay: false,
            dots: false,
            loop: true,
            responsiveRefreshRate: 200
        }).on('changed.owl.carousel', syncPosition);
        thumb.on('initialized.owl.carousel', function() {
                thumb.find(".owl-item").eq(0).addClass("current");
            }).owlCarousel({
                items: slidesPerPage,
                dots: false,
                nav: true,
                item: 4,
                smartSpeed: 200,
                slideSpeed: 500,
                slideBy: slidesPerPage,
              navText: ['<svg width="18px" height="18px" viewBox="0 0 11 20"><path style="fill:none;stroke-width: 1px;stroke: #000;" d="M9.554,1.001l-8.607,8.607l8.607,8.606"/></svg>', '<svg width="25px" height="25px" viewBox="0 0 11 20" version="1.1"><path style="fill:none;stroke-width: 1px;stroke: #000;" d="M1.054,18.214l8.606,-8.606l-8.606,-8.607"/></svg>'],
                responsiveRefreshRate: 100
            }).on('changed.owl.carousel', syncPosition2);
        function syncPosition(el) {
            var count = el.item.count - 1;
            var current = Math.round(el.item.index - (el.item.count / 2) - .5);
            if (current < 0) {
                current = count;
            }
            if (current > count) {
                current = 0;
            }
            thumb
                .find(".owl-item")
                .removeClass("current")
                .eq(current)
                .addClass("current");
            var onscreen = thumb.find('.owl-item.active').length - 1;
            var start = thumb.find('.owl-item.active').first().index();
            var end = thumb.find('.owl-item.active').last().index();
            if (current > end) {
                thumb.data('owl.carousel').to(current, 100, true);
            }
            if (current < start) {
                thumb.data('owl.carousel').to(current - onscreen, 100, true);
            }
        }
        function syncPosition2(el) {
            if (syncedSecondary) {
                var number = el.item.index;
                slider.data('owl.carousel').to(number, 100, true);
            }
        }
        thumb.on("click", ".owl-item", function(e) {
            e.preventDefault();
            var number = $(this).index();
            slider.data('owl.carousel').to(number, 300, true);
        });


            $(".qtyminus").on("click",function(){
                var now = $(".qty").val();
                if ($.isNumeric(now)){
                    if (parseInt(now) -1> 0)
                    { now--;}
                    $(".qty").val(now);
                }
            })
            $(".qtyplus").on("click",function(){
                var now = $(".qty").val();
                if ($.isNumeric(now)){
                    $(".qty").val(parseInt(now)+1);
                }
            });
    });
</script>
<script>
    $('#form-bid').on('submit',function someFunction(e){
       e.preventDefault();
       var form = $('#form-bid')[0];
       var dt = new FormData(form);
       $.ajax({
               type: 'POST',
               url: "/bidder/bid",
               data: dt,
               cache: false,
               processData: false,
               contentType: false,
               success: function (response) {

                  $('.gtt').remove();
                  $('#bids1').val('');
                  if (response['behb'] == '1') {
                     $('#behb').replaceWith("<p id='behb'><span style='margin-left: 15px; color:" + response['hb_color'] + ";'>" + 'Bạn đang là người đặt giá cao nhất!' + "</span></p>");
                  }
                  else {
                     $('#behb').replaceWith("<p id='behb'><span style='margin-left: 15px; color:" + response['hb_color'] + ";'>" + 'Bạn đang bị trả giá cao hơn!' + "</span></p>");
                  }
<!--                  $('#giatt').replaceWith("<p id='giatt'><span style='color: red; margin-left: 10px;'>" + "Giá tiền tối thiểu: "+ response['gtt'] + "<u>đ</u>.</span></p>");-->
                  alert(response['message']);
<!--                  location.reload();-->
               },
               error: function (response) {
<!--                  console.log(response)-->
               }
        });
    });
</script>
<script>
    $(document).ready(function(){
        $.ajax({
              type: 'POST',
               url: "/get_next_bids",
               data: {
                  csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                  id_room: $("#id_room").val(),
               },
               success: function (response) {
<!--                    $("#hb").replaceWith("<p id='behb'><span style='margin-left: 15px; color:" + response['hb_color'] + ";'>" + response['hb'] + "</span></p>");-->
<!--                    $(".next-bids").replaceWith("<p class='gtt'><span style='color: red; margin-left: 10px;'>" + "Giá tiền tối thiểu: "+ response['message'] + "<u>đ</u>.</span></p>");-->
               },
               error: function (response) {
                  console.log(response)
               }
       });
    });
</script>
<script>
        $(document).on('click','.close', function someFunction(e){
           e.preventDefault();
           $('#myModal').css("display", "none");
           $('#HistoryModal').css("display", "none");
        });
</script>
<script>
        $(document).on('click', '#show-modal', function someFunction(e){
           e.preventDefault();
           $('#myModal').css("display", "block");
           $('#bids1').val($('#bids0').val());
        });
</script>
<script>
   if ($('#room_status').val() == 'opening'){
    intervalID = setInterval(function () { roomend(); }, 1000);
    }
    function roomend() {

    if ($('#time_out').val() == "1"){
    let url = 'ws://'+ window.location.host +'/ws/room/end/'+$('#room_id').val()+'/';
    var chatSocket = new WebSocket(url);


    chatSocket.onopen = function (event) {
           event.preventDefault();
           chatSocket.send(JSON.stringify({
             'room_id': $('#room_id').val(),
             'timeout': $('#time_out').val(),
          }));
       };
    chatSocket.onmessage = function(e){
          console.log("message",e);
          var usrdata = JSON.parse(e.data);
           var winner = usrdata.winner;
           if (winner == $('#usr').val()) {
             $('#HistoryModal').css("display", "block");
             clearInterval(intervalID);
           }
           else {
<!--             clearInterval(intervalID);-->
<!--             alert('Đã hết thời gian đấu giá!');-->
<!--             clearInterval(intervalID);-->
<!--             window.location.href = "/home";-->
           }

<!--          alert(winner);-->
<!--          $('#show_his').html(usrdata.html_congr);-->
<!--          $('#show_his').html(usrdata.html_history);-->
        }

          clearInterval(intervalID);
      }

    }
</script>
<script>
<!--    setInterval(function () {-->
<!--        $('#current_bid1').load("/room/"+$('#room_id').val()+" #current_bid1");-->
<!--        $('#current_bid2').load("/room/"+$('#room_id').val()+" #current_bid2");-->
<!--     }, 1000);-->
</script>
{% endblock %}